<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.distributed.monitor.mapper.AdminReportConfigMapper">
    
    <!-- 统计报表配置数量 -->
    <select id="countAll" resultType="long">
        SELECT COUNT(1) FROM report_config
    </select>
    
    <!-- 按条件统计报表配置数量 -->
    <select id="countByCondition" resultType="long">
        SELECT COUNT(1) FROM report_config
        <where>
            <if test="reportType != null and reportType != ''">
                AND report_type = #{reportType}
            </if>
            <if test="isActive != null">
                AND is_active = #{isActive}
            </if>
        </where>
    </select>
    
    <!-- 分页查询报表配置 -->
    <select id="selectPage" resultType="ReportConfig">
        SELECT
            id,
            report_name AS reportName,
            report_code AS reportCode,
            report_type AS reportType,
            report_template AS reportTemplate,
            query_sql AS querySql,
            params_schema AS paramsSchema,
            description,
            is_active AS isActive,
            created_at AS createdAt,
            updated_at AS updatedAt
        FROM report_config
        ORDER BY id DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>
    
    <!-- 按条件分页查询报表配置 -->
    <select id="selectPageByCondition" resultType="ReportConfig">
        SELECT
            id,
            report_name AS reportName,
            report_code AS reportCode,
            report_type AS reportType,
            report_template AS reportTemplate,
            query_sql AS querySql,
            params_schema AS paramsSchema,
            description,
            is_active AS isActive,
            created_at AS createdAt,
            updated_at AS updatedAt
        FROM report_config
        <where>
            <if test="reportType != null and reportType != ''">
                AND report_type = #{reportType}
            </if>
            <if test="isActive != null">
                AND is_active = #{isActive}
            </if>
        </where>
        ORDER BY id DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>
    
    <!-- 根据ID查询报表配置 -->
    <select id="selectById" resultType="ReportConfig">
        SELECT
            id,
            report_name AS reportName,
            report_code AS reportCode,
            report_type AS reportType,
            report_template AS reportTemplate,
            query_sql AS querySql,
            params_schema AS paramsSchema,
            description,
            is_active AS isActive,
            created_at AS createdAt,
            updated_at AS updatedAt
        FROM report_config
        WHERE id = #{id}
    </select>
    
    <!-- 根据报表编码查询报表配置 -->
    <select id="selectByReportCode" resultType="ReportConfig">
        SELECT
            id,
            report_name AS reportName,
            report_code AS reportCode,
            report_type AS reportType,
            report_template AS reportTemplate,
            query_sql AS querySql,
            params_schema AS paramsSchema,
            description,
            is_active AS isActive,
            created_at AS createdAt,
            updated_at AS updatedAt
        FROM report_config
        WHERE report_code = #{reportCode}
    </select>
    
    <!-- 更新报表配置 -->
    <update id="update">
        UPDATE report_config
        <set>
            <if test="reportName != null">report_name = #{reportName},</if>
            <if test="reportTemplate != null">report_template = #{reportTemplate},</if>
            <if test="querySql != null">query_sql = #{querySql},</if>
            <if test="description != null">description = #{description},</if>
            <if test="isActive != null">is_active = #{isActive},</if>
            updated_at = NOW()
        </set>
        WHERE id = #{id}
    </update>
    
</mapper>

